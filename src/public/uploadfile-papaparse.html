<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div>
        <input type="file" id="csv-file" />
        <button onclick="processFile(event);">Submit</button>
    </div>
</body>
<script src="./papaparse.min.js"></script>
<script>
    function processFile(e) {
        e.preventDefault();
        const file = document.getElementById('csv-file').files[0];
        const quiz = {};
        const questions = [];
        const columns = [];

        let rowNumber = 0;
        Papa.parse(file, {
            step: function (row, parser) {
                const rowData = row.data[0];
                switch (rowNumber) {
                    case 0: // Quiz Columns
                    case 3: // Question Columns
                        for (let column of rowData) {
                            console.log('column: ');
                            console.log(column);
                            if (column) {
                                column = column.replace(/\s/g, "");
                                columns.push(column);
                            }
                        }
                        break;
                    case 1: // set quiz columns
                        for (let i = 0; i < columns.length; i++) {
                            quiz[columns[i]] = rowData[i];
                        }
                        break;
                    case 2: // reset columns to switch to question columns
                        columns.length = 0;
                        break;
                    default:
                        let isValidRow = false;
                        for (const field in rowData) {
                            if (field) {
                                isValidRow = true;
                                break;
                            }
                        }
                        if (isValidRow) {
                            const question = {};
                            for (let i = 0; i < columns.length; i++) {
                                question[columns[i]] = rowData[i];
                            }
                            questions.push(question);
                        }
                        break;
                }
                rowNumber++;
            },
            complete: function (results) {
                quiz.questions = questions;
                console.log("Complete:");
                console.log(quiz);
            }
        });
    };
</script>

</html>