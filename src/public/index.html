<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Game App</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="landing">
        <div class="row">
            <div class="col-lg-5 form d-flex flex-column justify-content-center">
                <div class="container">
                    <p class="pb-5 text-center">
                        <span class="text-secondary">Welcome to</span>
                        <br>
                        <img src="assets/img/logo.png" class="pb-3 pt-2" width="200" alt="">
                    </p>
                    <div id="login">
                        <h1 class="text-center">
                            <span class="text-secondary">Login.</span>
                        </h1>
                        <hr class="pb-3">
                        <div class="row">
                            <div id="result" class="col-lg-10 offset-md-1"></div>
                            <form action="" class="col-lg-10 offset-md-1">
                                <div class="form-group">
                                    <label for="email">User Detail</label>
                                    <input type="text" id='username' placeholder='Enter username, phone number or email address' name="email" class="form-control"
                                        required>
                                </div>
                                <div class="form-group">
                                    <label>Password</label>
                                    <input type="password" id='pass' name="password" placeholder="Enter password" class="form-control" required>
                                </div>
                                <a id='sub-login' href="" class="btn btn-brand mt-4 py-2 btn-block">Proceed to Dashboard</a>
                                <!-- <button type="submit" class="btn btn-brand mt-4 py-2 btn-block">Proceed to Dashboard</button> !use this for production-->
                                <div class="row pt-2">
                                    <span class="col-lg-5 text-center text-lg-left font-small">
                                        <a href="#" id="registerBtn">Sign up</a>
                                    </span>
                                    <span class="col-lg-7 text-center text-lg-right font-small">
                                        <a href="#" id="forgotPasswordBtn">Forgot password</a>
                                    </span>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div id="signup">
                        <h1 class="text-center">
                            <span class="text-secondary">Sign Up.</span>
                        </h1>
                        <hr>
                        <div class="row">
                            <span id='r_result'></span>
                            <form action="" class="col-lg-10 offset-md-1">
                                <div class="form-group">
                                    <input type="text" id="r-firstname" placeholder="First name" name="name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <input type="text" id='r-lastname' placeholder="Last name" name="name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <input type="text" id='r-username' placeholder="Username" name="email" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <input type="email" id='r-email' name="email" placeholder="Email address" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <input type="text" id='r-phone' name="email" placeholder="Phone number" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <select id='sec-que' class="form-control select">
                                    </select>
                                </div>
                                <div class="form-group">
                                    <input type="text" id='ans' name="answer" placeholder='Enter answer to security question' class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <input type="password" id='r-pass' placeholder="Enter password" class="form-control" required>
                                    <span id='passerr'></span>
                                </div>
                                <div class="form-group">
                                    <input type="password" id='r-cpass' placeholder="Re-enter password" class="form-control" required>
                                </div>
                                <a id='register' href="" class="btn btn-brand mt-4 py-2 btn-block">Register</a>
                                <!-- <button type="submit" class="btn btn-brand mt-4 py-2 btn-block">Proceed to Dashboard</button> !use this for production-->
                                <div class="row pt-2">
                                    <span class="col-12 text-center font-small">
                                        <a href="#" id="loginBtn">I'm a returning user</a>
                                    </span>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div id="forgot-password">
                        <h1 class="text-center">
                            <span class="text-secondary">Reset Password.</span>
                        </h1>
                        <hr class="pb-3">
                        <div class="row">
                            <form action="" class="col-lg-10 offset-md-1">
                                <div class="form-group">
                                    <label for="name">Enter either your email,phone or username that you used to register.</label>
                                    <input type="text" id="user-detail" name="name" class="form-control" required>
                                </div>
                                <a href id='reset' class="btn btn-brand mt-4 py-2 btn-block">Reset Password</a>
                                <!-- <button type="submit" class="btn btn-brand mt-4 py-2 btn-block">Proceed to Dashboard</button> !use this for production-->
                            </form>
                        </div>
                        <div class="row pt-2">
                            <span class="col-12 text-center font-small">
                                <a href="#" onclick="showLoginForm();">Back to login</a>
                            </span>
                        </div>
                    </div>
                    <p class="mt-5 text-center">
                        <i>Powered by
                            <a href="http://www.raoatech.com">Raoatech</a>
                        </i>
                    </p>
                </div>
            </div>
            <div class="col-lg-7 illustration d-flex flex-column justify-content-center align-items-center">
                <p class="py-3">
                    <img src="assets/img/svg/trophy.svg" width="200" style="transform: rotate(-10deg)" alt="">
                </p>
                <h4 class="text-center">Create your Quizzes and
                    <br> Polls with ease</h4>
                <footer>
                    <img src="assets/img/footer.png" width="100%" alt="">
                </footer>
            </div>
        </div>
    </div>
    <script src="js/app.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        $(function () {
            $("#sec-que").html(getSecurityQuestionsForDropdown());
            $('#sub-login').click(function (e) {
                e.preventDefault();
                var myUrl = window.location.origin + '/api/public/login';

                var username = $('#username').val();
                var pass = $('#pass').val();
                $.ajax({
                    url: myUrl,
                    type: 'post',
                    data: {
                        username: username,
                        password: pass
                    },
                    dataType: 'json',
                    async: false,
                    error: function (data) {
                        $('#result').html(`<div class="alert alert-warning">` + data.responseText + `</div`);
                    },
                    success: function (data) {
                        localStorage.setItem('userInfo', JSON.stringify(data.user));
                        localStorage.setItem("token", data.token);
                        window.location = 'pages/dashboard.html';
                    }
                });
            });
            $('#register').click(function (e) {
                e.preventDefault();
                var myUrl = window.location.origin + '/api/public/register';

                var firstname = $('#r-firstname').val();
                var lastname = $('#r-lastname').val();
                var email = $('#r-email').val();
                var phone = $('#r-phone').val();
                var username = $('#r-username').val();
                var pass = $('#r-pass').val();
                var cpass = $('#r-cpass').val();
                var sec_que = $('#sec-que').val();
                var ans = $('#ans').val();

                if (pass !== cpass) {
                    $('#passerr').html(`<div class="alert alert-warning">Password does\'nt match</div>`);
                } else {
                    $.ajax({
                        url: myUrl,
                        type: 'post',
                        data: {
                            firstname: firstname,
                            lastname: lastname,
                            email: email,
                            phone: phone,
                            username: username,
                            password: pass,
                            securityanswer: ans,
                            securityquestion: sec_que
                        },
                        dataType: 'json',
                        async: false,
                        error: function (data) {
                            console.log(data);
                            $('#r_result').html(`<div class="alert alert-warning">` + data.responseText + `</div`);
                        },
                        success: function (data) {
                            // On success, we log user in automatically.
                            localStorage.setItem('userInfo', JSON.stringify(data.user));
                            localStorage.setItem("token", data.token);
                            window.location = 'pages/dashboard.html';
                        }
                    });
                }
            });
            $('#reset').click(function (e) {
                e.preventDefault();
                var username = $('#user-detail').val();
                window.location = 'pages/security-question.html?username=' + username;
            });
        });
    </script>
</body>

</html>